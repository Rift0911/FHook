jdk:
  - openjdk17

env:
  ANDROID_SDK_ROOT: /home/jitpack/android-sdk
  ANDROID_HOME: /home/jitpack/android-sdk
  PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

install:
  - set -e
  - chmod +x ./gradlew

  # 1) 安装 Android cmdline-tools
  - mkdir -p $ANDROID_SDK_ROOT
  - curl -fsSL https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip -o cmdtools.zip
  - unzip -q cmdtools.zip -d $ANDROID_SDK_ROOT/cmdline-tools
  - mv $ANDROID_SDK_ROOT/cmdline-tools/cmdline-tools $ANDROID_SDK_ROOT/cmdline-tools/latest

  # 2) 预置 License（避免交互阻塞）
  - mkdir -p $ANDROID_SDK_ROOT/licenses
  - echo "24333f8a63b6825ea9c5514f83c2829b004d1fee" > $ANDROID_SDK_ROOT/licenses/android-sdk-license
  - echo "84831b9409646a918e30573bab4c9c91346d8abd" > $ANDROID_SDK_ROOT/licenses/android-sdk-preview-license

  # 3) 装 SDK 组件（注意：使用稳定的 NDK r27）
  - yes | $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager --sdk_root=$ANDROID_SDK_ROOT "platforms;android-35" "build-tools;35.0.1" "platform-tools" "cmake;3.22.1" "ndk;27.0.12077973"

  # 4) 构建并发布到本地 Maven（JitPack 会抓 ~/.m2 产物）
  - ./gradlew -Pgroup=com.github.Rift0911 -Pversion=${VERSION} :fhook:clean :fhook:assembleRelease :fhook:publishReleasePublicationToMavenLocal

  # 5) 产物校验（日志里能直接看到 .aar/.pom）
  - echo "== M2 ==" && ls -R ~/.m2/repository/com/github/Rift0911/fhook || true
  - test -f ~/.m2/repository/com/github/Rift0911/fhook/${VERSION}/fhook-${VERSION}.aar
